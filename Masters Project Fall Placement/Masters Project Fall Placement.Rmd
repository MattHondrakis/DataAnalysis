---
title: "Masters Project: Job Placement"
author: "Matthew"
date: "2022-12-07"
output: 
  github_document:
    toc: true
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, dpi = 500)
library(tidyverse)
library(scales)
library(patchwork)
library(tidymodels)
theme_set(theme_bw())
theme_update(plot.title = element_text(hjust = 0.5))
theme_update(panel.grid.minor = element_blank())
```

```{r}
fall <- read_csv("C:/Users/Matthew Hondrakis/OneDrive/Documents/DataAnalysis/Masters Project Fall Placement/fall2022Placement.csv")
```

# Intro

This is a structured analysis guided by the assignment provided by my friends professor. The task is as follows.

-   **Cleanse**: Look for null data in the table, and use the appropriate strategy to handle null data for each column. Explain why this was the strategy that you used.

-   **Outliers**: Search the data for outliers and remove them. Use the appropriate outlier method(s). Show all work.

-   **Who are these graduates?**: Create 4-5 visualizations providing useful and explanatory information about these graduates. The visualizations should show trends, correlations, and other useful patterns that the data provides.\
    Remember, we are dealing with senior management. The charts must be readable, meaningful and at a summary level.\
    Use at least one group/by or bin in your analysis.

-   **Who are most likely to get placed?**: Create visualizations to show management qualities specific to those who are likely to get placed at jobs. Show three meaningful visualizations.\
    Use at least one group/by or bin in your analysis.

-   **Prepare the data for a regression analysis**: The XYZ management company team has heard that it might be possible to use their data to make predictions. They don't know much about data analytics. We are hoping that an example of what is possible will help them understand better.\
    Prepare the data file to run with a regression analysis. Use the techniques and methods discussed in class. (*I'm not a student, so I'm unfamiliar with what methods were discussed in class*)

-   **Run the regression analysis**: Show the regression scoring. Split the data into training and test sets. Show a confusion matrix for both.

## Data Dictionary

```{r data_dictionary}
knitr::kable(readxl::read_excel("C:/Users/Matthew Hondrakis/OneDrive/Documents/DataAnalysis/Masters Project Fall Placement/Data dictionary.xlsx"))
```

# Cleanse

```{r skim_NA}
skimr::skim(fall) %>% select(skim_type, skim_variable, n_missing)
```

As we can see, we have *N/A* values for:

-   *hsc_s* (Specialization in Higher Secondary Education): **1**

-   *specialisation* (Area of speciality): **1**

-   *hsc_p* (Higher Secondary Education percentile): **2**

-   *salary* (Salary of job offered): **67**

```{r count_NA}
fall %>% 
  count(hsc_s, sort = TRUE)
fall %>% 
  count(specialisation, sort = TRUE)
```

I am going to make a few assumptions. I will take "Mkt" to mean "Marketing", "Fin" to mean "Finance", "HR" to mean "Human Resources". We see only one variable having the value of "Mt", which we may assume is a typo or just an outlier. For now, I will consider this a valid data point, assume it means something like "Management or Math" and wont change it to "Mkt".

```{r mutual_NAs}
fall %>% 
  filter(is.na(hsc_s)) %>% 
  select(salary)
fall %>% 
  filter(is.na(specialisation)) %>% 
  select(salary)
```

The row that has a missing value for *hsc_s* (Specialization in Higher Secondary Education) also contains a missing value for *salary*; this is not the case for when specialisation is NA.

```{r}
fall %>% 
  group_by(specialisation) %>% 
  count(hsc_s) %>% 
  mutate(prop = n/sum(n)) %>% 
  arrange(specialisation, -n)
fall %>% 
  group_by(hsc_b) %>% 
  count(hsc_s) %>% 
  mutate(prop = n/sum(n)) %>% 
  arrange(hsc_b, -n)
```

Most of "Mkt&HR" are evenly distributed between **Science** and **Commerce**. Thus its not possible at the moment to decide which one of the 2 should be used to fill in the missing value. With regards to *hsc_b* (Board of Education), the majority of **Central** are in **Commerce**. This may provide a clue later on, but it is still too early to make an assumption.

```{r NA_salary}
fall %>% 
  group_by(missing = is.na(salary)) %>% 
  count(status) %>% 
  arrange(status)
```

As we can see, all missing values for *salary* are from individuals that were not offered a job. Since the Data Dictionary defines *Salary* as "Salary of job offered", individuals that were not offered a job, do not have a salary from an offer. Therefore, *salary* will be 0 for individuals that were not offered a job. We will then drop any rows that had missing information, which in total is only **4**.

```{r}
clean_fall <- fall %>% 
  mutate(salary = ifelse(is.na(salary), 0, salary)) %>% 
  drop_na()
```

# Outliers

```{r}
(fall %>% 
  ggplot(aes(salary)) +
  geom_histogram() +
  scale_x_log10(labels = comma_format())) /
(fall %>% 
  ggplot(aes(salary)) +
  geom_boxplot() +
  scale_x_log10(labels = comma_format()) +
  theme(axis.ticks.y = element_blank(),
        axis.text.y = element_blank(),
        axis.line.y = element_blank(),
        panel.grid.major.y = element_blank())) +
  plot_annotation(title = "Salary Distribution")
```

Removing outliers below by filtering out the top 8 salaries and the lowest salary. We are now left with **202** rows out of **215**.

```{r}
clean_fall %>% 
  filter(salary != 0) %>% 
  arrange(salary) %>% 
  slice(1) %>% 
  pull(salary)

updated_fall <- clean_fall %>% 
  arrange(-salary) %>% 
  slice(-c(1:8)) %>% 
  filter(salary != 45000) 
```

# Who are these graduates?

A quick check on the **correlations** between **numeric** variables.

```{r}
updated_fall %>% 
  keep(is.numeric) %>%
  cor() %>% 
  as.data.frame() %>% 
  rownames_to_column(var = "item1") %>% 
  gather(key = item2, value = corr, -item1) %>% 
  filter(item1 > item2) %>% 
  arrange(-abs(corr))
```

Below I will create a function to quickly plot **counts** of factor variables. It is often advised to make a function if one foresees using the same plot/code often. Since this dataset contains many **factor** variables, I assume there will be a lot of factor count plotting.

```{r count_plot_function}
count_plot <- function(x){
  updated_fall %>% 
    filter(!is.na({{x}})) %>% 
    count({{x}}) %>% 
    ggplot(aes(n, fct_reorder({{x}}, n))) + 
    geom_col(color = "black", fill = "lightblue") +
    geom_text(aes(label = n), hjust = 1.3, size = 3)
}
```

```{r character_plot}
(count_plot(gender) +
  labs(x = "", y = "", title = "Number of Graduates by Gender") +
  theme(panel.grid.major.y = element_blank())) /
count_plot(degree_t) +
  labs(y = "", x = "", title = "Degree Type") +
  theme(panel.grid.major.y = element_blank())

(count_plot(hsc_s) +
   labs(y = "", x = "", title = "Higher Education Specialisation") +
   theme(panel.grid.major.y = element_blank())) /
(count_plot(workex) +
   labs(y = "", x = "", title = "Work Experience") +
   theme(panel.grid.major.y = element_blank()))
```

## 1. Salary Distribution by Gender

```{r}
updated_fall %>% 
  filter(status == "Placed") %>% 
  ggplot(aes(salary, gender, color = gender)) + 
  geom_boxplot() +
  scale_x_log10(label = comma_format()) +
  labs(y = "", x = "Salary", title = "Salary Distribution by Gender") +
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        panel.grid.major.y = element_blank())
```

## 2. Percent Specialization in Higher Secondary Education by Gender

Given the unequal distribution of the *gender* variable, I am plotting the **percent** distribution of each specialization for each gender. As we can see, the percentage of males or females choosing a certain specialization is approximately equal. A *chisq.test* is provided below to reinforce our confidence in this assumption. As can be seen, the *p.value* is **0.3856** which means there is not enough evidence to suggest that the two genders have uneven specialization distributions.

```{r}
group_count <- function(x,y){
  updated_fall %>%
    group_by({{x}}) %>% 
    count({{y}}) %>% 
    mutate(prop = n/sum(n)) %>% 
    ggplot(aes(prop, {{x}}, 
               fill = fct_reorder2({{y}}, {{x}}, prop, .desc = FALSE))) +
    geom_col(color = "black", position = position_dodge())
}
```

```{r}
group_count(gender,hsc_s) +
  geom_text(aes(label = paste0(round(prop*100,1), "%")), 
            position = position_dodge2(0.9), hjust = 1, size = 3.5) +
  labs(fill = "", x = "", y = "", 
       title = "Percent Specialization in Higher Secondary Education by Gender") +
  scale_x_continuous(label = percent_format(), breaks = seq(0,0.5,0.1)) +
  theme(panel.grid.major.y = element_blank())
```

```{r}
chisq.test(updated_fall$gender, updated_fall$hsc_s)
```

# Who are most likely to get placed?

```{r}
updated_fall %>% 
  ggplot(aes(etest_p, status, color = status)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.5, height = 0.1) +
  labs(y = "", x = "Employability Test Percentile", 
       title = "Employability Test Percentile by Job Placement")
```
